<head>
  <script src="skulpt.min.js"></script>
  <script src="skulpt-stdlib.js"></script>
  <script src="EV3devSim.js"></script>
  <link rel="stylesheet" href="main.css">
</head>

<div id="field"></div>

<div class="row">
  <div>
    <button id="start">Start</button>
    <button id="stop">Stop</button>
  </div>
  <div>
    <select id="map">
      <option>None</option>
      <option>WRO 2019 Regular Junior</option>
      <option>WRO 2018 Regular Junior</option>
    </select>
  </div>
  <div class="right">
    X : <input type="text" id="xPos"><br>
    Y : <input type="text" id="yPos"><br>
    Angle : <input type="text" id="angle"><br>
    <button id="move">Move</button>
  </div>
</div>

<script>
  function setPos(x, y, angle) {
    var x = parseFloat(x);
    var y = parseFloat(y);
    var angleRadian = parseFloat(angle) / 180 * Math.PI;

    if (isNaN(x)) { x = 0; }
    if (isNaN(y)) { y = 0; }
    if (isNaN(angleRadian)) { angleRadian = 0; angle = 0; }

    document.getElementById('xPos').value = x;
    document.getElementById('yPos').value = y;
    document.getElementById('angle').value  = angle;

    sim.setRobotPos(x, y, angleRadian);
    sim.drawRobot();
  }

  // Main
  var sim = new EV3devSim('field');
  setPos(2362/2, 1143/2, 0);

  document.getElementById('start').addEventListener('click', function() {
    sim.startAnimation();
  });
  document.getElementById('stop').addEventListener('click', function() {
    sim.stopAnimation();
  });
  document.getElementById('move').addEventListener('click', function() {
    setPos(
      document.getElementById('xPos').value,
      document.getElementById('yPos').value,
      document.getElementById('angle').value
    );
  });
  document.getElementById('map').addEventListener('change', function() {
    var map = document.getElementById('map').value;

    if (map == 'WRO 2019 Regular Junior') {
      sim.loadBackground('WRO-2019-Regular-Junior.png');
      setPos(2215, 180, 90);

    } else if (map == 'WRO 2018 Regular Junior') {
      sim.loadBackground('WRO-2018-Regular-Junior.png');
      setPos(1181, 180, 90);

    } else {
      sim.clearBackground();
      setPos(2362/2, 1143/2, 0);
    }
  });

</script>